<script>
  // Year
  document.getElementById('year').textContent = new Date().getFullYear();

  // Helpers
  function revealNow(el){ el.classList.add('show'); }

  // If IntersectionObserver isnâ€™t available or page is in an iframe where it never fires,
  // we still show the content.
  function safeReveal(){
    const els = Array.from(document.querySelectorAll('.reveal'));
    if (!('IntersectionObserver' in window)) {
      els.forEach(revealNow);
      return;
    }
    const io = new IntersectionObserver((entries)=>{
      entries.forEach(e=>{
        if(e.isIntersecting){ revealNow(e.target); io.unobserve(e.target); }
      });
    }, { threshold: .15 });

    // Show anything already in/near viewport right away
    els.forEach(el=>{
      io.observe(el);
      const rect = el.getBoundingClientRect();
      if (rect.top < window.innerHeight * 0.9) revealNow(el);
    });

    // Failsafe: after 1s, if nothing revealed yet, show all
    setTimeout(()=>{
      if (!document.querySelector('.reveal.show')) els.forEach(revealNow);
    }, 1000);
  }

  // Scroll spy (safe even if sections are already shown)
  function initSpy(){
    const navLinks = Array.from(document.querySelectorAll('[data-nav]'));
    const sections = ['services','work','about']
      .map(id=>document.getElementById(id))
      .filter(Boolean);

    function spy(){
      let current = null;
      for(const sec of sections){
        const top = sec.getBoundingClientRect().top - 90;
        if(top <= 0) current = sec.id;
      }
      navLinks.forEach(a=>{
        if(a.getAttribute('href') === '#' + current) a.classList.add('active');
        else a.classList.remove('active');
      });
    }
    spy();
    document.addEventListener('scroll', spy, {passive:true});
  }

  // Init
  document.addEventListener('DOMContentLoaded', ()=>{
    safeReveal();
    initSpy();
  });
</script>
